<div class="admin-container">
  <header class="admin-header">
    <div class="header-left">
      <a routerLink="/dashboard" class="logo-link">
        <img src="/logo.png" class="logo-icon" alt="Logo">
        <span class="logo-text">Ocorr√™ncias Escolares</span>
      </a>
    </div>
    <div class="header-right">
      <div class="user-info">
        <span class="user-label">üë§ {{ userEmail || 'Carregando...' }}</span>
      </div>
      <button class="btn-adicionar" (click)="abrirModalNovaEscola()">
        + Nova Escola
      </button>
      <button class="btn-logout" (click)="logout()">
        üö™ Sair
      </button>
    </div>
  </header>

  <main class="admin-content">
    <div class="page-header">
      <h1>Painel Administrativo</h1>
      <p>Gerencie escolas e usu√°rios do sistema</p>
    </div>

    <!-- Loading -->
    <div class="loading" *ngIf="carregandoEscolas">
      <p>Carregando escolas...</p>
    </div>

    <!-- Erro -->
    <div class="erro-mensagem" *ngIf="erroCarregar && !carregandoEscolas">
      <p>‚ö†Ô∏è {{ erroCarregar }}</p>
    </div>

    <!-- Tabela de Escolas -->
    <div class="tabela-wrapper" *ngIf="!carregandoEscolas">
      <div class="tabela-container">
        <table class="tabela-escolas">
          <thead>
            <tr>
              <th>Nome da Escola</th>
              <th>Email Dire√ß√£o</th>
              <th>Email Coordena√ß√£o</th>
              <th>Plano</th>
              <th>Status</th>
              <th>Data Cria√ß√£o</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let escola of escolas">
              <td>{{ escola.nome }}</td>
              <td>{{ escola.emailDirecao }}</td>
              <td>{{ escola.emailCoordenacao || '-' }}</td>
              <td>
                <span class="badge badge-plano" [class.trial]="escola.plano === 'trial'">
                  {{ escola.plano === 'mensal' ? 'Mensal' : escola.plano === 'anual' ? 'Anual' : 'Trial' }}
                </span>
              </td>
              <td>
                <span class="badge badge-status" [class.inativo]="escola.status === 'inativo'">
                  {{ escola.status === 'ativo' ? 'Ativa' : 'Inativa' }}
                </span>
              </td>
              <td>{{ escola.criadoEm | date: 'dd/MM/yyyy' }}</td>
              <td>
                <div class="btn-acoes">
                  <button class="btn-usuarios" (click)="abrirModalUsuarios(escola)" title="Gerenciar Usu√°rios">
                    üë•
                  </button>
                  <button class="btn-editar" (click)="abrirModalEditarEscola(escola)" title="Editar">
                    ‚úèÔ∏è
                  </button>
                  <button class="btn-deletar" (click)="deletarEscola(escola)" title="Deletar">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="escolas.length === 0">
              <td colspan="7" style="text-align: center; padding: 2rem; color: #6B7280;">
                Nenhuma escola cadastrada ainda.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Modal Nova/Editar Escola -->
  <div class="modal-overlay" *ngIf="mostrarModalNovaEscola" (click)="fecharModalNovaEscola()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ modoEdicao ? 'Editar Escola' : 'Adicionar Nova Escola' }}</h2>
        <button class="btn-fechar" (click)="fecharModalNovaEscola()">‚úï</button>
      </div>

      <form class="form-escola" (ngSubmit)="salvarNovaEscola()">
        <div class="form-group">
          <label for="nome">Nome da Escola *</label>
          <input 
            type="text" 
            id="nome" 
            [(ngModel)]="novaEscola.nome" 
            name="nome"
            placeholder="Ex: Escola Estadual Jo√£o da Silva"
            required>
        </div>

        <div class="form-group">
          <label for="emailDirecao">Email da Dire√ß√£o *</label>
          <input 
            type="email" 
            id="emailDirecao" 
            [(ngModel)]="novaEscola.emailDirecao" 
            name="emailDirecao"
            placeholder="direcao@escola.com"
            required>
        </div>

        <div class="form-group">
          <label for="emailCoordenacao">Email da Coordena√ß√£o</label>
          <input 
            type="email" 
            id="emailCoordenacao" 
            [(ngModel)]="novaEscola.emailCoordenacao" 
            name="emailCoordenacao"
            placeholder="coordenacao@escola.com">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="plano">Plano</label>
            <select id="plano" [(ngModel)]="novaEscola.plano" name="plano">
              <option value="trial">Trial (Teste)</option>
              <option value="mensal">Mensal</option>
              <option value="anual">Anual</option>
            </select>
          </div>

          <div class="form-group">
            <label for="status">Status</label>
            <select id="status" [(ngModel)]="novaEscola.status" name="status">
              <option value="ativo">Ativa</option>
              <option value="inativo">Inativa</option>
            </select>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-cancelar" (click)="fecharModalNovaEscola()">
            Cancelar
          </button>
          <button type="submit" class="btn-salvar" [disabled]="salvandoEscola">
            {{ salvandoEscola ? 'Salvando...' : (modoEdicao ? 'Atualizar Escola' : 'Salvar Escola') }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Gerenciar Usu√°rios -->
  <div class="modal-overlay" *ngIf="mostrarModalUsuarios" (click)="fecharModalUsuarios()">
    <div class="modal-content modal-usuarios" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Usu√°rios - {{ escolaSelecionada?.nome }}</h2>
        <button class="btn-fechar" (click)="fecharModalUsuarios()">‚úï</button>
      </div>

      <!-- Formul√°rio de Adicionar/Editar Usu√°rio -->
      <div class="form-usuario" *ngIf="mostrarFormUsuario">
        <h3>{{ modoEdicaoUsuario ? 'Editar Usu√°rio' : 'Adicionar Novo Usu√°rio' }}</h3>
        <form (ngSubmit)="salvarUsuario()">
          <div class="form-group">
            <label for="userEmail">Email *</label>
            <input 
              type="email" 
              id="userEmail" 
              [(ngModel)]="novoUsuario.email" 
              name="userEmail"
              placeholder="usuario@email.com"
              [disabled]="modoEdicaoUsuario"
              required>
          </div>

          <div class="form-group">
            <label for="userName">Nome *</label>
            <input 
              type="text" 
              id="userName" 
              [(ngModel)]="novoUsuario.nome" 
              name="userName"
              placeholder="Nome completo"
              required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="userRole">Fun√ß√£o</label>
              <select id="userRole" [(ngModel)]="novoUsuario.role" name="userRole">
                <option value="professor">Professor</option>
                <option value="coordenacao">Coordena√ß√£o</option>
                <option value="direcao">Dire√ß√£o</option>
                <option value="secretaria">Secretaria</option>
              </select>
            </div>

            <div class="form-group">
              <label for="userAtivo">Status</label>
              <select id="userAtivo" [(ngModel)]="novoUsuario.ativo" name="userAtivo">
                <option [value]="true">Ativo</option>
                <option [value]="false">Inativo</option>
              </select>
            </div>
          </div>

          <div class="form-group-checkbox" *ngIf="!modoEdicaoUsuario">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [(ngModel)]="enviarEmailAutomatico" 
                name="enviarEmail"
                id="enviarEmail">
              <span class="checkbox-text">
                <strong>üìß Enviar email automaticamente</strong>
                <small>O usu√°rio receber√° um email com o link e instru√ß√µes para criar a senha</small>
              </span>
            </label>
          </div>

          <div class="info-primeiro-acesso" *ngIf="!modoEdicaoUsuario">
            <p>‚ÑπÔ∏è <strong>Importante:</strong> {{ enviarEmailAutomatico ? 'Um email ser√° enviado automaticamente com o link de primeiro acesso.' : 'Voc√™ precisar√° enviar manualmente o link de Primeiro Acesso para o usu√°rio definir sua senha.' }}</p>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-cancelar" (click)="fecharFormUsuario()">
              Cancelar
            </button>
            <button type="submit" class="btn-salvar" [disabled]="salvandoUsuario">
              {{ salvandoUsuario ? 'Salvando...' : (modoEdicaoUsuario ? 'Atualizar' : 'Adicionar') }}
            </button>
          </div>
        </form>
      </div>

      <!-- Lista de Usu√°rios -->
      <div class="usuarios-content" *ngIf="!mostrarFormUsuario">
        <div class="usuarios-header-acoes">
          <button class="btn-adicionar-usuario" (click)="abrirFormNovoUsuario()">
            + Adicionar Usu√°rio
          </button>
          <button class="btn-copiar-link" (click)="copiarLinkPrimeiroAcesso()" title="Copiar link do Primeiro Acesso">
            üîó Copiar Link de Cadastro
          </button>
        </div>

        <div class="loading" *ngIf="carregandoUsuarios">
          <p>Carregando usu√°rios...</p>
        </div>

        <div class="usuarios-lista" *ngIf="!carregandoUsuarios">
          <div class="usuario-card" *ngFor="let usuario of usuarios">
            <div class="usuario-info">
              <h4>{{ usuario.nome }}</h4>
              <p class="usuario-email">{{ usuario.email }}</p>
              <div class="usuario-badges">
                <span class="badge badge-role">{{ usuario.role }}</span>
                <span class="badge badge-status" [class.inativo]="!usuario.ativo">
                  {{ usuario.ativo ? 'Ativo' : 'Inativo' }}
                </span>
              </div>
            </div>
            <div class="usuario-acoes">
              <button class="btn-editar-pequeno" (click)="abrirFormEditarUsuario(usuario)" title="Editar">
                ‚úèÔ∏è
              </button>
              <button class="btn-deletar-pequeno" (click)="deletarUsuario(usuario)" title="Deletar">
                üóëÔ∏è
              </button>
            </div>
          </div>

          <div class="usuarios-vazio" *ngIf="usuarios.length === 0">
            <p>Nenhum usu√°rio cadastrado nesta escola.</p>
            <p style="font-size: 0.9rem; color: #666;">Clique em "Adicionar Usu√°rio" para come√ßar.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
